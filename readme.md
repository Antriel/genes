# genes

[![CI](https://github.com/benmerckx/genes/workflows/CI/badge.svg)](https://github.com/benmerckx/genes/actions)

Generates split ES6 modules and Typescript definitions from Haxe modules.

Requires Haxe 4, status: experimental

## Usage

````
lix +lib genes
````

Install the library and add `-lib genes` to your hxml.


### Defines

- `-D dts` to generate Typescript definition files
- [`-debug`](https://haxe.org/manual/debugging-source-map.html) or [`-D js-source-map`](https://haxe.org/manual/debugging-source-map.html) to generate source maps
- [`-D source_map_content`](https://haxe.org/manual/debugging-source-map-javascript.html) to include source map contents
- `-D genes.unchanged_no_rewrite` don't write output files if there's no change 
  (compares output to file on disk)
- `-D genes.extern_init_warning` display a warning wherever an extern `__init__` 
  is used as these are not generated by genes
- `-D genes.disable` disable genes completely (eg. to compare results to default
  haxe js generator)
- `-D genes.include_extension` include extension in import paths


## Dynamic imports

```haxe
import genes.Genes.dynamicImport;
import my.module.MyClass;
// ...
dynamicImport(MyClass -> new MyClass()).then(trace);
```

Translates to:

```js
import('./my/module/MyClass')
  .then(({MyClass}) => new MyClass())
  .then(console.log)
```

Genes expects a single-argument function declaration expression (`EFunction`) as the sole argument of `dynamicImport` and it will do 2 things:

1. Get the argument name (e.g. "MyClass") and resolve it as a type in the current context, taking Haxe `import` statements into account. This is for preparing the relative path of the target file (e.g. `'../../MyClass.js'`).
2. Type the function body in the current context, ignoring the fact that it is a function body. Thus in the example the scope of `MyClass` is not the function argument but in current context i.e. the actual type `class MyClass {...}`. The return type is then applied as the type parameter of `js.lib.Promise`. This is for hinting the return type of the `dynamicImport(...)` call so that the compiler can do its typing job properly.

## Alternatives

- Split output with require calls: [hxgenjs](https://github.com/kevinresol/hxgenjs)
- Typescript definition generation: [hxtsdgen](https://github.com/nadako/hxtsdgen)
